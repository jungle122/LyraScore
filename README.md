# Lyra吉他谱本 🎸

> 吉他手的私人云端琴房 ☁️

一款功能完整的微信小程序，帮助吉他爱好者管理、整理和练习吉他谱。支持自制谱编辑、图片导入、纸质谱归档，以及强大的多维度检索系统。

## ✨ 核心功能

### 1. **曲谱管理**
- 🎼 **自制谱编辑**：手动输入歌词与和弦，支持调性转换、节拍设置、BPM调节
- 📸 **图片导入**：上传吉他谱截图或照片，支持批量操作
- 📖 **纸质谱归档**：记录纸质谱的书名、页码，支持拍照备份

### 2. **多维度检索系统** (v2.2.0新增)
- 🔍 **搜索功能**：支持按歌名、歌手名模糊搜索（排除回收站）
- 🎸 **乐器筛选**：区分吉他/尤克里里
- 🎤 **风格筛选**：弹唱/指弹两种演奏方式
- 📊 **排序方式**：最新存、最久练、按名字排序

### 3. **练习追踪**
- ✅ **状态管理**：正在练 → 已练完 → 回收站
- 📈 **统计展示**：一键查看练习进度
- 🎯 **快速转移**：便捷的状态流转

### 4. **辅助工具**
- 🎺 **调音器**：实时音频识别
- ⏰ **节拍器**：可调节速度和拍号
- 🔒 **屏幕常亮**：读谱时防止屏幕自动熄灭

### 5. **阅读器**
- 📖 **文本展示**：自制谱内容清晰展示
- 📷 **图片浏览**：导入谱的图片查看
- ✏️ **快速编辑**：无需返回，一键进入编辑

## 🛠️ 技术栈

| 技术 | 版本 | 说明 |
|------|------|------|
| 微信小程序 | - | 原生开发框架 |
| 微信云开发 | - | 云数据库、云存储 |
| JavaScript (ES6+) | - | 业务逻辑 |
| WXML | - | 模板语言 |
| WXSS | - | 样式语言 |

## 📁 项目结构

```
miniprogram-2/
├── pages/                    # 小程序页面
│   ├── add/                 # 添加曲谱页面
│   ├── editor/              # 曲谱编辑器
│   ├── practicing/          # 正在练习列表
│   ├── finished/            # 已练完列表
│   ├── search/              # 搜索页面
│   ├── reader/              # 曲谱阅读器
│   ├── tuner/               # 调音器
│   ├── metronome/           # 节拍器
│   ├── profile/             # 个人中心（"我"）
│   └── trash/               # 回收站
├── utils/                    # 工具函数
├── images/                   # 图片资源
├── audio/                    # 音频资源
├── cloudfunctions/           # 云函数（如需）
├── app.js                   # 小程序入口
├── app.json                 # 小程序配置
├── app.wxss                 # 全局样式
└── project.config.json      # 项目配置
```

## 🚀 快速开始

### 前置条件
- 微信开发者工具
- 微信小程序账号
- 已启用微信云开发

### 安装步骤

1. **克隆或下载项目**
   ```bash
   git clone <repository-url>
   cd miniprogram-2
   ```

2. **使用微信开发者工具打开**
   - 打开微信开发者工具
   - 点击"导入项目"
   - 选择 `miniprogram-2` 文件夹
   - 配置 AppID（需要小程序账号）

3. **初始化云开发**
   - 在开发者工具中打开云开发控制台
   - 创建名为 `songs` 的云数据库集合
   - 为集合创建以下字段索引（根据需要）

4. **编译运行**
   - 点击"编译"或按 `Ctrl + B`
   - 在模拟器或真机中预览

## 📊 数据库结构

### songs 集合

```javascript
{
  _id: ObjectId,              // 云数据库自动生成
  id: Number,                 // 时间戳（用户自定义ID）
  type: String,               // 'blank' | 'paper' | 'image'
  status: String,             // 'practicing' | 'finished' | 'deleted'
  title: String,              // 歌曲名
  artist: String,             // 歌手名
  instrument: String,         // '吉他' | '尤克里里'
  style: String,              // '弹唱' | '指弹'
  
  // 自制谱字段
  key: String,                // 选调
  originalKey: String,        // 原调
  capo: Number,               // Capo位置
  timeSignature: String,      // 拍号
  bpm: Number,                // 速度
  tuning: String,             // 调音方式
  content: String,            // 和弦和歌词内容
  comment: String,            // 备注
  
  // 纸质谱字段
  location: String,           // 位置（书名、页码等）
  
  // 图片谱字段
  imagePaths: Array,          // 云端图片路径数组
  
  // 时间戳
  createTime: String,         // 创建日期
  updateTime: Number,         // 最后修改时间
}
```

## 💡 主要功能说明

### 三维度检索系统

**筛选维度**
- 乐器：全部/吉他/尤克里里
- 风格：全部/弹唱/指弹

**排序方式**
- 最新存：按 `id` 降序（新曲谱在前）
- 最久练：按 `id` 升序（最早创建的在前）
- 按名字：按 `title` 升序（A-Z 字母顺序）

**搜索逻辑**
- 排除 `status === 'deleted'` 的记录（不搜索回收站）
- 支持模糊匹配，同时检索歌名和歌手名
- 不区分大小写

### 状态流转

```
新建曲谱
    ↓
正在练 (practicing)
    ├→ 已练完 (finished)
    │   └→ 回收站 (deleted)
    └→ 回收站 (deleted)
```

## 🔧 开发说明

### 添加新功能

1. 在 `pages/` 中创建新页面文件夹
2. 按照现有页面结构创建 `.js`、`.wxml`、`.wxss`、`.json` 文件
3. 在 `app.json` 的 `pages` 数组中注册新页面

### 修改数据库结构

- 编辑新字段时，确保向后兼容
- 对于旧数据缺失的字段，在查询时设置默认值

### 云函数开发

若需要服务端逻辑（如批量操作），在 `cloudfunctions/` 目录创建函数。

## 📝 使用建议

1. **定期备份**：云端数据定期导出备份
2. **调整字体大小**：根据个人阅读习惯微调 WXSS
3. **关于权限**：支持微信分享，朋友可点击链接进入小程序

## 🐛 已知问题 & 改进计划

- [ ] 多选删除功能
- [ ] 曲谱标签/分类功能
- [ ] 与朋友共享曲谱
- [ ] 导出为 PDF
- [ ] 暗黑模式支持

## 📄 License

GNU General Public License v3.0 (GPLv3) © 2024

本项目采用 GPLv3 许可证。这意味着：
- ✅ 可以自由使用、修改和分发本项目代码
- ⚠️ **任何基于本项目的修改版本也必须开源并采用相同许可证**
- ⚠️ 必须保留原作者的版权声明和许可证说明

详见 [LICENSE](./LICENSE) 文件。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📧 联系方式

如有问题或建议，欢迎通过微信小程序内的"关于"页面反馈。

---

**Lyra吉他谱本** - 让练琴更简单，让音乐更美好 🎵
