<view class="container">
  
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="nav-bar">
    <!-- ç‚¹å‡»è¿™é‡Œï¼Œæ‰“å¼€æŠ½å±‰ -->
    <view class="menu-btn" bindtap="openDrawer">
      <text style="font-weight:bold; font-size: 40rpx;">Â·Â·Â·</text>
    </view>
  </view>

  <!-- æ ‡é¢˜åŒº -->
  <view class="header-area">
    <text class="title">{{song.title}}</text>
    <text class="artist" wx:if="{{song.artist}}">{{song.artist}}</text>
  </view>

  <!-- å‚æ•°åŒº -->
  <view class="meta-section" wx:if="{{song.type === 'blank'}}">
    <view class="meta-row">
      <view class="meta-item"><text class="label">é€‰è°ƒ</text><text class="value">{{song.key}}</text></view>
      <view class="meta-item"><text class="label">åŸè°ƒ</text><text class="value">{{song.originalKey}}</text></view>
      <view class="meta-item"><text class="label">Capo</text><text class="value">{{song.capo}}</text></view>
    </view>
    <view class="meta-row">
      <view class="meta-item"><text class="label">æ‹å·</text><text class="value">{{song.timeSignature}}</text></view>
      <view class="meta-item"><text class="label">BPM</text><text class="value">{{song.bpm}}</text></view>
      <view class="meta-item"><text class="label">è°ƒå¼¦</text><text class="value">{{song.tuning}}</text></view>
    </view>
  </view>

  <view class="paper-info" wx:if="{{song.type === 'paper'}}">
    <text>ğŸ“ æ›²è°±ä½äºï¼š{{song.location}}</text>
  </view>
<!-- âœ¨ å›¾ç‰‡è°±å±•ç¤º (éå†æ˜¾ç¤ºï¼Œç‚¹å‡»å…¨å±) -->
<view class="image-content" wx:if="{{song.type === 'image'}}">
    <block wx:for="{{song.imagePaths}}" wx:key="*this">
      <image 
        src="{{item}}" 
        mode="widthFix" 
        lazy-load="true" 
        style="width: 100%; display: block; margin-bottom: 20rpx; background-color: #f0f0f0; min-height: 400rpx;"
        bindtap="previewImage"
        data-current="{{item}}"
      />
    </block>
  </view>
  <!-- æ­Œè¯åŒº -->
  <!-- âœ¨ æ ¸å¿ƒï¼šstyle="font-size: {{fontSize}}rpx" -->
  <!-- è¿™æ ·æˆ‘ä»¬æ‹–åŠ¨æ»‘å—ï¼Œå­—å°±ä¼šå˜å¤§å˜å° -->
  <text 
    class="content-area" 
    user-select="true" 
    style="font-size: {{fontSize}}rpx"
  >{{song.content}}</text>

</view>

<!-- ========================= -->
<!-- âœ¨ è‡ªå®šä¹‰æŠ½å±‰èœå• (å®Œæ•´ç‰ˆ) -->
<!-- ========================= -->

<view class="drawer-mask" wx:if="{{showDrawer}}" bindtap="closeDrawer"></view>

<view class="drawer-panel" wx:if="{{showDrawer}}">
  <text class="drawer-title">æ›´å¤šæ“ä½œ</text>

  <view class="menu-group">
    <!-- âœ¨ æ ¸å¿ƒä¿®æ”¹ï¼šæ¡ä»¶åˆ¤æ–­ -->
    <!-- å¦‚æœçŠ¶æ€æ˜¯ 'finished' -->
    <block wx:if="{{song.status === 'finished'}}">
      <view class="menu-item" bindtap="markAsPracticing" style="color: #1976d2;">
        ğŸ”„ é‡æ–°ç»ƒä¹ 
      </view>
    </block>
    <!-- å¦åˆ™ (ä¹Ÿå°±æ˜¯ 'practicing') -->
    <block wx:else>
      <view class="menu-item" bindtap="markAsFinished" style="color: #52c41a;">
        ğŸ‰ æ ‡è®°ä¸ºå·²å­¦ä¼š
      </view>
    </block>
    
    <view class="menu-item" bindtap="goToEdit">âœï¸ ç¼–è¾‘æ›²è°±</view>
  </view>

  <view class="divider"></view>

  <!-- 2. å­—ä½“ç¼©æ”¾åŒº -->
  <view class="control-group">
    <view class="control-header">
      <text class="control-label">å­—ä½“å¤§å°</text>
      <text class="control-value">{{fontSize}}</text>
    </view>
    <slider 
      min="24" max="60" value="{{fontSize}}" 
      activeColor="#333" block-size="18"
      bindchanging="onZoomChange" 
    />
  </view>

<!-- 3. è§¦æ„ŸèŠ‚æ‹å™¨åŒº -->
<view class="control-group">
      <view class="control-header">
        <text class="control-label">èŠ‚æ‹å™¨ (å£°éŸ³)</text>
        <switch checked="{{isPlaying}}" bindchange="toggleMetronome" color="#333"/>
      </view>
      
      <view wx:if="{{isPlaying}}" style="margin-top: 20rpx;">
        <view class="control-header">
          <text class="control-sub-label">é€Ÿåº¦ (BPM)</text>

          <!-- âœ¨ æ ¸å¿ƒä¿®æ”¹ï¼šæŠŠæ–‡æœ¬æ¢æˆè¾“å…¥æ¡† -->
          <!-- type="number"ï¼šè®©æ‰‹æœºå¼¹å‡ºæ•°å­—é”®ç›˜ -->
          <!-- value="{{currentBpm}}"ï¼šå’Œæ»‘å—å…±äº«åŒä¸€ä¸ªæ•°æ®æº -->
          <!-- bindinput="onBpmInput"ï¼šæ¯æ¬¡æ‰“å­—æ—¶ï¼Œéƒ½å»æ‰§è¡Œ JS é‡Œçš„ onBpmInput å‡½æ•° -->
          <input 
            class="bpm-input" 
            type="number" 
            value="{{currentBpm}}" 
            bindinput="onBpmInput" 
          />
        </view>
        <slider 
          min="40" max="200" value="{{currentBpm}}" 
          activeColor="#fa7298" block-size="18"
          bindchanging="changeBpm" 
        />
      </view>
    </view>

  <view class="divider"></view>

  <!-- 4. åº•éƒ¨åˆ é™¤ -->
  <view class="menu-item delete" bindtap="deleteSong">ğŸ—‘ï¸ åˆ é™¤æ›²è°±</view>
</view>