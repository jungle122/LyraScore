<wxs src="./finished.wxs" module="utils" />
<view class="container">
  
  <view class="top-bar" wx:if="{{!isEditMode}}">
    <!-- ä¼ªæœç´¢æ¡†ï¼šå…¶å®æ˜¯ä¸€ä¸ªæŒ‰é’® -->
    <view class="search-entry" bindtap="goToSearch">
      <view class="search-box">
        <text class="search-icon">ğŸ”</text> 
        <text class="search-text">æœç´¢æ›²è°±...</text>
      </view>
    </view>
    <view class="manage-btn" bindtap="toggleEditMode">ç®¡ç†</view>
  </view>

  <view class="manage-toolbar" wx:if="{{isEditMode}}">
    <view class="toolbar-left" bindtap="toggleSelectAll">
      <view class="select-all-circle {{selectedIds.length > 0 && selectedIds.length === songList.length ? 'checked' : ''}}"></view>
      <text class="toolbar-text">å…¨é€‰</text>
    </view>
    <text class="toolbar-count">å·²é€‰ {{selectedIds.length}}</text>
    <view class="toolbar-done" bindtap="toggleEditMode">å®Œæˆ</view>
  </view>

  <!-- ç­›é€‰å’Œæ’åºèƒ¶å›Š -->
  <view class="filter-sort">
    <!-- è¡Œ1ï¼šä¹å™¨ç­›é€‰ -->
    <scroll-view scroll-x="true" class="filter-bar">
      <view class="filter-capsule {{selectedInstrument === 'all' ? 'active' : ''}}" bindtap="onFilterChange" data-value="all">å…¨éƒ¨</view>
      <view class="filter-capsule {{selectedInstrument === 'guitar' ? 'active' : ''}}" bindtap="onFilterChange" data-value="guitar">ğŸ¸å‰ä»–</view>
      <view class="filter-capsule {{selectedInstrument === 'ukulele' ? 'active' : ''}}" bindtap="onFilterChange" data-value="ukulele">ğŸ¥¥å°¤å…‹é‡Œé‡Œ</view>
    </scroll-view>
    <!-- è¡Œ2ï¼šé£æ ¼ç­›é€‰ -->
    <scroll-view scroll-x="true" class="filter-bar">
      <view class="filter-capsule {{selectedStyle === 'all' ? 'active' : ''}}" bindtap="onStyleChange" data-value="all">å…¨éƒ¨</view>
      <view class="filter-capsule {{selectedStyle === 'fingerstyle' ? 'active' : ''}}" bindtap="onStyleChange" data-value="fingerstyle">ğŸ¤å¼¹å”±</view>
      <view class="filter-capsule {{selectedStyle === 'picking' ? 'active' : ''}}" bindtap="onStyleChange" data-value="picking">ğŸ¸æŒ‡å¼¹</view>
    </scroll-view>
    <!-- è¡Œ3ï¼šæ’åº -->
    <scroll-view scroll-x="true" class="sort-bar">
      <view class="filter-capsule {{selectedSort === 'newest' ? 'active' : ''}}" bindtap="onSortChange" data-value="newest">æœ€æ–°å­˜</view>
      <view class="filter-capsule {{selectedSort === 'oldest' ? 'active' : ''}}" bindtap="onSortChange" data-value="oldest">æœ€ä¹…ç»ƒ</view>
      <view class="filter-capsule {{selectedSort === 'name' ? 'active' : ''}}" bindtap="onSortChange" data-value="name">æŒ‰åå­— (A-Z)</view>
    </scroll-view>
  </view>

  <!-- åˆ—è¡¨ç»“æ„å®Œå…¨å¤ç”¨ -->
  <view class="song-list">
    <block wx:for="{{songList}}" wx:key="id">
      <view class="song-card" bindtap="onCardTap" data-id="{{item.id}}" data-uid="{{item._id}}">
        <view class="select-circle {{utils.isSelected(selectedIds, item._id) ? 'checked' : ''}}" wx:if="{{isEditMode}}" catchtap="toggleSelectItem" data-uid="{{item._id}}"></view>
        <view class="card-info">
          <text class="song-title">{{item.title}}</text>
          <text class="song-artist">{{item.artist ? item.artist : ' - '}}</text>
          <text class="song-meta" wx:if="{{item.type === 'paper'}}">ğŸ“ {{item.location}}</text>
          <text class="song-meta" wx:if="{{item.type === 'blank'}}">ğŸ¼ {{item.key}}è°ƒ | {{item.bpm}} BPM</text>
        </view>
        <view class="card-tag {{item.type}}">
          {{item.type === 'blank' ? 'è‡ªåˆ¶' : (item.type === 'paper' ? 'å½’æ¡£' : 'å›¾ç‰‡')}}
        </view>
      </view>
    </block>
  </view>

  <!-- ç©ºçŠ¶æ€ä¿®æ”¹ -->
  <view class="empty-state" wx:if="{{songList.length === 0}}">
    <text>è¿˜æ²¡æœ‰ç»ƒå®Œçš„æ›²è°±</text>
    <text>å¿«å»ç»ƒä¹ å§ï¼</text>
  </view>

  <view class="action-bar" wx:if="{{isEditMode}}">
    <view class="action-btn delete-btn {{selectedIds.length === 0 ? 'disabled' : ''}}" bindtap="batchDelete">åˆ é™¤</view>
    <view class="action-btn {{selectedIds.length === 0 ? 'disabled' : ''}}" bindtap="batchMove">ç§»è‡³æ­£åœ¨ç»ƒ</view>
  </view>

</view>